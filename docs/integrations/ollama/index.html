<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Ollama Integration — Praeon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root{--bg:#0b0c10;--panel:#101218;--text:#e8ebf0;--muted:#a4adbd;--brand:#7aa2ff;--border:#1a1f2b;--radius:16px;--maxw:960px}
    *{box-sizing:border-box}body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:var(--bg);color:var(--text)}
    a{color:var(--brand)}.wrap{max-width:var(--maxw);margin:0 auto;padding:24px}
    .panel{background:#0d0f15;border:1px solid var(--border);border-radius:var(--radius);padding:18px;margin:14px 0}
    .muted{color:var(--muted)}pre{background:#0d1117;border:1px solid var(--border);border-radius:12px;padding:12px;overflow:auto}
    code{background:#0d1117;border:1px solid var(--border);border-radius:6px;padding:0 6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Ollama Integration</h1>
    <p class="muted">Drop-in sidecar today. Loader-native plug-in behind a feature flag.</p>

    <div class="panel">
      <h2>Mode A — Sidecar (verify before Ollama starts)</h2>
      <p>Use <code>praeon gate</code> to verify the signed manifest and materialize approved weights into a sealed store that Ollama reads from.</p>
      <pre># 1) Verify manifest + policy; admit or deny; materialize weights into ./verified-store
praeon gate verify \
  --manifest ./model.mwal.json \
  --policy   ./policy.hcl \
  --runtime  ollama \
  --load     ./weights/llama3.1-q4_k_m.gguf \
  --out-store ./verified-store

# 2) Point OLLAMA_MODELS at the sealed store and start Ollama
export OLLAMA_MODELS="$(pwd)/verified-store"
ollama serve</pre>
      <p class="muted">If the artifact is not attested or out of policy, Praeon denies and Ollama never sees the weights.</p>
    </div>

    <div class="panel">
      <h2>Mode B — Docker Compose (init step)</h2>
      <pre>services:
  praegate:
    image: ghcr.io/praeon/gate:preview
    volumes:
      - ./manifests:/manifests:ro
      - verified-store:/verified
      - ./policies:/policies:ro
    command: >
      praeon gate verify
        --manifest /manifests/model.mwal.json
        --policy   /policies/prod.hcl
        --runtime  ollama
        --load     /weights/llama3.1-q4_k_m.gguf
        --out-store /verified
  ollama:
    image: ollama/ollama:latest
    depends_on: [praegate]
    environment:
      - OLLAMA_MODELS=/models
    volumes:
      - verified-store:/models:ro
volumes:
  verified-store: {}</pre>
      <p class="muted">Praeon runs once to verify + stage weights; Ollama mounts the read-only verified volume.</p>
    </div>

    <div class="panel">
      <h2>Mode C — systemd unit wrapper</h2>
      <pre>[Unit]
Description=Praeon gate + Ollama
After=network-online.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/praeon gate verify --manifest /etc/praeon/model.mwal.json --policy /etc/praeon/prod.hcl --runtime ollama --load /opt/weights/llama3.1.gguf --out-store /var/lib/praeon/verified
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target</pre>
      <pre>[Unit]
Description=Ollama (verified store)
Requires=praeon.service
After=praeon.service

[Service]
Environment=OLLAMA_MODELS=/var/lib/praeon/verified
ExecStart=/usr/bin/ollama serve
Restart=on-failure

[Install]
WantedBy=multi-user.target</pre>
    </div>

    <div class="panel">
      <h2>Receipts & Export</h2>
      <pre># Export last admit to Splunk (example)
praeon receipt export --to splunk --file ./receipts/$(date -u +%FT%H-%MZ).json</pre>
    </div>

    <div class="panel">
      <h2>Notes</h2>
      <ul>
        <li>Default deny: without an admitted artifact in the verified store, Ollama loads nothing.</li>
        <li>TEE quotes optional: enable per policy if your host supports Intel TDX/Azure CC.</li>
        <li>CRL + transparency log: Gate enforces current <code>crl_version</code> and fails closed on stale revocation state (configurable maintenance window).</li>
      </ul>
    </div>
  </div>
</body>
</html>
